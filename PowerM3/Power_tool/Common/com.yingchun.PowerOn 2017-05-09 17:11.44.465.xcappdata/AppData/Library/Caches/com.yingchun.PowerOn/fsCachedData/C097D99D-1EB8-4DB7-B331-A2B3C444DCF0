/**
copyright @2014 普华科技
http://www.p3china.com/
**/
(function($,window,document,undefined){window.console=window.console||{log:function(){},error:function(){}};var userAgent=navigator.userAgent,ua={};ua.RTL=false;ua.match=function(ua){var rwebkit=/(webkit)[ \/]([\w.]+)/,ropera=/(opera)(?:.*version)?[ \/]([\w.]+)/,rmsie=/(msie) ([\w.]+)/,rmozilla=/(mozilla)(?:.*? rv:([\w.]+))?/;ua=ua.toLowerCase();var match=rwebkit.exec(ua)||ropera.exec(ua)||rmsie.exec(ua)||ua.indexOf("compatible")<0&&rmozilla.exec(ua)||[];return{ua:match[1]||"",version:parseFloat(match[2]||"0")}};var uaMatch=ua.match(userAgent);if(uaMatch.ua){ua[uaMatch.ua]=true;ua.version=uaMatch.version}if(!$.browser){$.browser=ua}ua.isTouchDevice=function(){try{document.createEvent("TouchEvent");return true}catch(e){return false}};ua.kickout=!!(ua.msie&&ua.version<8);ua.ie8=!!(ua.msie&&ua.version==8);ua.ie9=!!(ua.msie&&ua.version==9);ua.oldIE=ua.kickout||ua.ie8;ua.modern=!ua.kickout&&!ua.ie8;ua.isTouch="ontouchstart" in document||ua.isTouchDevice();ua.isPad=/(iPad)|(webOS)|(hpwOS)|(TouchPad)/.test(userAgent);ua.isMobile=ua.isTouch&&!ua.isPad;var msPointer=window.navigator.msPointerEnabled;ua.events=ua.isTouch?{start:msPointer?"MSPointerDown":"touchstart",move:msPointer?"MSPointerMove":"touchmove",end:msPointer?"MSPointerCancel":"touchend",cancel:msPointer?"MSPointerCancel":"touchcancel",click:"tap",resize:"onorientationchange" in window?"orientationchange":"resize"}:{start:"mousedown",move:"mousemove",end:"mouseup",click:"click",resize:"resize"};ua.getViewPort=function(orent){var e=window,a="inner";if(!("innerWidth" in window)){a="client";e=document.documentElement||document.body}return{width:e[a+"Width"],height:e[a+"Height"]}};var transitionEnd=function(){var el=document.documentElement;var names={"WebkitTransition":"webkitTransitionEnd","MozTransition":"transitionend","OTransition":"oTransitionEnd otransitionend","transition":"transitionend"};for(var name in names){if(el.style[name]!==undefined){return{name:name,end:names[name]}}}return{}};var substitute=function(str,o,regexp){if(typeof str!="string"||!o){return str}return str.replace(regexp||/\\?#\{([^{}]+)\}/igm,function(match,name){if(match.charAt(0)==="\\"){return match.slice(1)}return(o[name]===undefined)?"":o[name]})};var parseOption=function(el,attr){attr=el.getAttribute(attr);if(attr==null||attr==undefined){return null}else{return eval("("+"{".concat(attr).concat("}")+")")}};var getURLParameter=function(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)","i");var r=window.location.search.substr(1).match(reg);if(r!=null){return decodeURIComponent(r[2])}return null};var setURLParameter=function(key,value){var search=location.search.slice(1);var href=location.href.split("?")[0];var matchExec=function(string,name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)","i");var ret=string.match(reg);return ret?ret[0]:""};var params="";if(typeof key=="object"){for(var i in key){if(key.hasOwnProperty(i)){params+=("&"+i+"="+key[i]);search=search.replace(matchExec(search,i),"")}}}else{params+=("&"+key+"="+value);search=search.replace(matchExec(search,key),"")}params=search?(search+params):params.slice(1);location.href=href+"?"+params};var isImgPath=function(path){return/\.(?:png|gif|jpg|jpeg|bmp)$/i.test(path)};var stringBuffer=function(){var buffer=function(){this.aryBuf=isIE?[]:""};var fn=buffer.prototype;fn.add=ua.oldIE?function(str){this.aryBuf.push(str);return this}:function(str){this.aryBuf+=str;return this};fn.toString=function(){if(!this.aryBuf){return""}return[].slice.call(this.aryBuf).join("")};fn.destroy=function(){this.aryBuf=null};return new buffer()};var namespace=function(names){if(typeof names!="string"){return}var Parent=window,name,obj;if(names.charAt(0)=="."){names=names.slice(1);Parent=Parent.Power}names=names.split(".");for(var i=0,l=names.length;i<l;i++){name=names[i];obj=Parent[name];if(obj==undefined){obj=Parent[name]={}}Parent=obj}};var getOffset=function(element,offsetParent){var offset={top:0,left:0};if(!element||element.nodeType!==1){return offset}if(offsetParent){return{left:element.offsetLeft,top:element.offsetTop}}var doc=element.nodeType===9?element:element.ownerDocument,docElem=doc.documentElement,body=doc.body,box=element.getBoundingClientRect(),scrollTop=docElem.scrollTop||body.scrollTop,scrollLeft=docElem.scrollLeft||body.scrollLeft,clientTop=docElem.clientTop||body.clientTop||0,clientLeft=docElem.clientLeft||body.clientLeft||0;return{top:Math.round(box.top)+scrollTop-clientTop,left:Math.round(box.left)+scrollLeft-clientLeft,bottom:Math.round(box.bottom)+scrollTop-clientTop,right:Math.round(box.right)+scrollLeft-clientLeft}};var createVMLNode;var initVML=function(win){if(initVML.Hooked){return}var doc=(win||window).document;doc.createStyleSheet().addRule(".rvml","behavior:url(#default#VML);display:inline-block;");try{doc.namespaces.add("v","urn:schemas-microsoft-com:vml");createVMLNode=function(tagName){return doc.createElement("<v:"+tagName+' class="rvml">')}}catch(e){createVMLNode=function(tagName){return doc.createElement("<v:"+tagName+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')
}}initVML.Hooked=true};var _createVML=function(tagName,props){if(ua.modern){return}initVML();var VMLNode=createVMLNode(tagName);VMLNode.style.cssText="position:absolute;left:0;top:0";if(props.attr){if(props.attr.strokecolor==undefined){props.attr.strokecolor=props.attr.fillcolor}for(var i in props.attr){VMLNode.setAttribute(i,props.attr[i])}}if(props.css){for(var k in props.css){var prop=props.css[k];if(k==="opacity"){VMLNode.style.filter="alpha(opacity='"+parseFloat(prop)+"')";continue}VMLNode.style[k]=parseFloat(prop)+(String(prop).replace(/^[-\d.]+/,"")||"px")}}return VMLNode};var _createVMLHTML=function(tagName,props){if(ua.modern){return""}initVML();return"<v:"+tagName+' style="position:absolute;left:0;top:0;width: '+props.width+"px; height: "+props.height+'px;" class="rvml" fillcolor="'+props.color+'" strokecolor="'+props.color+'" arcsize="'+(props.arcsize||0.5)+'" />'};$.fn.implement=function(method,Class){this[method]=function(option,event){var args=arguments,value,chain=this.each(function(){var $this=$(this),key="Power."+method,data=$this.data(key),options=typeof option=="object"&&option;if(!data){$this.data(key,(data=new Class(this,options,event)))}else{if(options){for(var i in options){data.options[i]=options[i]}}}if(typeof option=="string"){var property=option;if(data[property]!==undefined){if(data[property] instanceof Function){[].shift.apply(args);value=data[property].apply(data,args)}else{value=data[property]}}else{throw new Error('"'+property+'"'+" is not instance of "+Class.prototype.plugin||"")}}});return value!==undefined?value:chain}};$.fn.tap=!ua.isTouch?$.fn.click:function(handler){return this.each(function(){this.addEventListener(ua.events.end,handler,false)})};window.Power=window.Power||{};Power.provide=function(methods){for(var i in methods){if(methods.hasOwnProperty(i)){Power[i]=methods[i]}}};Power.extend=function(source){var props=Array.prototype.slice.call(arguments,1);var prop,p;for(var i=0;i<props.length;i++){for(p in (prop=props[i])){if(prop.hasOwnProperty(p)){source[p]=prop[p]}}}return source};Power.provide({ua:ua,support:{},transition:transitionEnd(),parseOption:parseOption,namespace:namespace,getOffset:getOffset,stringBuffer:stringBuffer,initVML:initVML,createVML:_createVML,createVMLHTML:_createVMLHTML,detect:{isImgPath:isImgPath}});if(Power.transition.name){Power.transition.name=Power.transition.name.toLowerCase().replace(/transition$/,"")}Power.support.transition=!!Power.transition.end;Power.support.SVG=function(){var SVG_NS="http://www.w3.org/2000/svg";return !!document.createElementNS&&!!document.createElementNS(SVG_NS,"svg").createSVGRect};Power.keyboard={left:37,top:38,right:39,bottom:40,pageup:33,pagedown:34,end:35,home:36,enter:13,esc:27,space:32,tab:9,del:46,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123};Power.extend(Array.prototype,{forEach:function(fn){for(var i=0,l=this.length;i<l;i++){if(fn&&fn.call(this[i],this[i],i,this)===false){break}}},contains:function(ary){return this.indexOf(ary)>-1},indexOf:function(ary,from){var len=this.length;for(var i=from<0?Math.max(0,len+from):from||0;i<len;i++){if(this[i]===ary){return i}}return -1}});Power.provide({String:{format:substitute},Parameter:{get:getURLParameter,set:setURLParameter},Number:{guid:function(len){var g="",i=0;len=len||32;while(i++<len){g+=Math.floor(Math.random()*16).toString(16);if((i==8)||(i==12)||(i==16)||(i==20)){g+="-"}}return g}},Object:{each:function(object,fn){for(var i in object){if(fn&&fn.call(object[i],i,object[i],object)===false){break}}}},Array:{each:function(array,callback){return Array.prototype.forEach.call(array,callback)},toTree:function(data,nodesField,idField,parentIdField){nodesField=nodesField||"children";idField=idField||"Id";parentIdField=parentIdField||"ParentId";var nodes=[],idHash={},o,i,id,p;for(i=0,l=data.length;i<l;i++){o=data[i];if(!o){continue}id=o[idField];if(id!==null&&id!==undefined){idHash[id]=o}delete o[nodesField]}for(i=0,l=data.length;i<l;i++){o=data[i];p=idHash[o[parentIdField]];if(!p){nodes.push(o);continue}if(!p[nodesField]){p[nodesField]=[]}p[nodesField].push(o)}return nodes}},tree:{toArray:function(nodes,nodesField,idField,parentIdField,parentId){nodesField=nodesField||"children";var array=[],node,childrenNodes,id,childrenArray;for(var i=0,l=nodes.length;i<l;i++){node=nodes[i];array[array.length]=node;if(parentIdField){node[parentIdField]=parentId}childrenNodes=node[nodesField];if(childrenNodes&&childrenNodes.length>0){id=node[idField];childrenArray=this.toArray(childrenNodes,nodesField,idField,parentIdField,id);[].push.apply(array,childrenArray)}}return array}}});Power.provide({cookie:{defaults:{path:"/"},set:function(key,value,expires,path,domain,secure){if(value==undefined){return}var options={expires:expires,domain:domain,secure:secure};if(path){options.path=path}options=Power.extend({},this.defaults,options);if(value===null||value===""){options.expires=-1}if(typeof options.expires==="number"){var days=options.expires,time=options.expires=new Date();
time.setDate(time.getDate()+days)}return(document.cookie=[encodeURIComponent(key),"=",encodeURIComponent(String(value)),options.expires?"; expires="+options.expires.toUTCString():"",options.path?"; path="+options.path:"",options.domain?"; domain="+options.domain:"",options.secure?"; secure":""].join(""))},get:function(key){var cookies=document.cookie.split("; "),result=key?null:{},parts,name,cookie;var decode=function(s){return unRfc2068(decodeURIComponent(s.replace(/\+/g," ")))};var unRfc2068=function(value){if(value.indexOf('"')===0){value=value.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}return value};for(var i=0,l=cookies.length;i<l;i++){parts=cookies[i].split("=");name=decode(parts.shift());cookie=decode(parts.join("="));if(key&&key===name){result=cookie;break}if(!key){result[name]=cookie}}return result},remove:function(key){if(this.get(key)!==null){var arg=[].slice.call(arguments,1);arg.unshift(key,null);this.set.apply(this,arg);return true}return false}}});Power.provide({Date:{format:function(source,pattern){if("string"!=typeof pattern){return source.toString()}function replacer(patternPart,result){pattern=pattern.replace(patternPart,result)}var year=source.getFullYear(),month=source.getMonth()+1,date2=source.getDate(),hours=source.getHours(),minutes=source.getMinutes(),seconds=source.getSeconds();replacer(/yyyy/g,year.pad(4));replacer(/yy/g,parseInt(year.toString().slice(2),10).pad(2));replacer(/MM/g,month.pad(2));replacer(/M/g,month);replacer(/dd/g,date2.pad(2));replacer(/d/g,date2);replacer(/HH/g,hours.pad(2));replacer(/H/g,hours);replacer(/hh/g,(hours%12).pad(2));replacer(/h/g,hours%12);replacer(/mm/g,minutes.pad(2));replacer(/m/g,minutes);replacer(/ss/g,seconds.pad(2));replacer(/s/g,seconds);return pattern}},parse:function(source){var reg=new RegExp("^\\d+(\\-|\\/)\\d+(\\-|\\/)\\d+\x24");if("string"==typeof source){if(reg.test(source)||isNaN(Date.parse(source))){var d=source.split(/ |T/),d1=d.length>1?d[1].split(/[^\d]/):[0,0,0],d0=d[0].split(/[^\d]/);return new Date(d0[0]-0,d0[1]-1,d0[2]-0,d1[0]-0,d1[1]-0,d1[2]-0)}else{return new Date(source)}}return new Date()}});Power.provide({htmlEncode:function(str){if(typeof str!=="string"){return str}if(str.length==0){return""}str=str.replace(/&/g,"&amp;");str=str.replace(/</g,"&lt;");str=str.replace(/>/g,"&gt;");str=str.replace(/ /g,"&nbsp;");str=str.replace(/\'/g,"&#39;");str=str.replace(/\"/g,"&quot;");return s},htmlDecode:function(str){if(typeof str!=="string"){return str}if(str.length==0){return""}str=str.replace(/&gt;/g,"&");str=str.replace(/&lt;/g,"<");str=str.replace(/&gt;/g,">");str=str.replace(/&nbsp;/g," ");str=str.replace(/&#39;/g,"'");str=str.replace(/&quot;/g,'"');return str}});Power.provide({storage:(function(){var api={},localStorageName="localStorage",globalStorageName="globalStorage",store;api.set=$.noop;api.get=$.noop;api.remove=$.noop;api.clear=$.noop;if(localStorageName in window&&window[localStorageName]){store=window[localStorageName];api.set=function(key,val){store.setItem(key,val)};api.get=function(key){return store.getItem(key)};api.remove=function(key){store.removeItem(key)};api.clear=function(){store.clear()}}else{if(globalStorageName in window&&window[globalStorageName]){store=window[globalStorageName][window.location.hostname];api.set=function(key,val){store[key]=val};api.get=function(key){return store[key]&&store[key].value};api.remove=function(key){delete store[key]};api.clear=function(){for(var key in store){delete store[key]}}}else{if(document.documentElement.addBehavior){function createStorage(){if(store){return store}store=document.body.appendChild(document.createElement("input"));store.type="hidden";store.addBehavior("#default#userData");store.load(localStorageName);return store}api.set=function(key,val){var store=createStorage();store.setAttribute(key,val);store.save(localStorageName)};api.get=function(key){var store=createStorage();return store.getAttribute(key)};api.remove=function(key){var store=createStorage();store.removeAttribute(key);store.save(localStorageName)};api.clear=function(){var store=createStorage();var attributes=store.XMLDocument.documentElement.attributes;store.load(localStorageName);for(var i=0,attr;attr=attributes[i];i++){store.removeAttribute(attr.name)}store.save(localStorageName)}}}}return api})()});(function(){var _head,_stack={};var _settings={jsPrefix:"",cssPrefix:"",charset:"utf-8",debug:false},config=function(config){Power.extend(_settings,config)},getHead=function(){if(_head!=undefined){return _head}return _head=document.head||document.getElementsByTagName("head")[0]},importCss=function(src){if(_stack[src]){return}var link=document.createElement("link");link.setAttribute("type","text/css");link.setAttribute("rel","stylesheet");link.setAttribute("href",_settings.cssPrefix+src.replace(/^\s+|\s+$/g,""));getHead().appendChild(link);_stack[src]=true},importStyle=function(cssText){var cssStyle=document.createElement("style");cssStyle.type="text/css";if(cssStyle.styleSheet){cssStyle.styleSheet.cssText=cssText
}else{cssStyle.appendChild(document.createTextNode(cssText))}getHead().appendChild(cssStyle)},importImg=function(src,callback){var img=new Image();img.onload=function(){img.onload=new Function;typeof callback=="function"&&callback(img)};img.onerror=function(){img.onerror=new Function;console.error("image: "+src+" load failed!")};img.src=src},importJs=function(path,fn,option){if(_stack[path]){if(typeof fn==="function"){fn(script)}return}option=option||{};var script=document.createElement("script");script.setAttribute("type","text/javascript");script.setAttribute("src",_settings.jsPrefix+path.replace(/^\s+|\s+$/g,""));script.setAttribute("chartset",option.charset||_settings.charset);script.onload=script.onreadystatechange=function(){if(!this.readyState||this.readyState==="loaded"||this.readyState==="complete"){script.onload=script.onreadystatechange=new Function;_stack[path]=true;if(typeof fn==="function"){fn(script)}if(!_settings.debug){script.parentNode.removeChild(script)}}};script.onerror=function(){script.onerror=new Function;console.error("load script: "+path+" failed!")};getHead().appendChild(script)},require=function(queue,callback){var _jsStack=[];for(var i=0;i<queue.length;i++){if(/\.css(\?.+)?\s*$/.test(queue[i])){importCss(queue[i])}else{_jsStack.push(queue[i])}}var index=0,length=_jsStack.length;importJs(_jsStack[index],function(){if(++index>length-1){callback&&callback();return}importJs(_jsStack[index],arguments.callee)})};Power.provide({include:{js:importJs,css:importCss,style:importStyle,img:importImg},require:require,config:config})})();(function(){var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(input){var output="";var chr1,chr2,chr3,enc1,enc2,enc3,enc4;var i=0;input=Base64._utf8_encode(input);while(i<input.length){chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=((chr1&3)<<4)|(chr2>>4);enc3=((chr2&15)<<2)|(chr3>>6);enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64}else{if(isNaN(chr3)){enc4=64}}output=output+this._keyStr.charAt(enc1)+this._keyStr.charAt(enc2)+this._keyStr.charAt(enc3)+this._keyStr.charAt(enc4)}return output},decode:function(input){var output="";var chr1,chr2,chr3;var enc1,enc2,enc3,enc4;var i=0;input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(i<input.length){enc1=this._keyStr.indexOf(input.charAt(i++));enc2=this._keyStr.indexOf(input.charAt(i++));enc3=this._keyStr.indexOf(input.charAt(i++));enc4=this._keyStr.indexOf(input.charAt(i++));chr1=(enc1<<2)|(enc2>>4);chr2=((enc2&15)<<4)|(enc3>>2);chr3=((enc3&3)<<6)|enc4;output=output+String.fromCharCode(chr1);if(enc3!=64){output=output+String.fromCharCode(chr2)}if(enc4!=64){output=output+String.fromCharCode(chr3)}}output=Base64._utf8_decode(output);return output},_utf8_encode:function(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c)}else{if((c>127)&&(c<2048)){utftext+=String.fromCharCode((c>>6)|192);utftext+=String.fromCharCode((c&63)|128)}else{utftext+=String.fromCharCode((c>>12)|224);utftext+=String.fromCharCode(((c>>6)&63)|128);utftext+=String.fromCharCode((c&63)|128)}}}return utftext},_utf8_decode:function(utftext){var string="";var i=0;var c=c1=c2=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=String.fromCharCode(c);i++}else{if((c>191)&&(c<224)){c2=utftext.charCodeAt(i+1);string+=String.fromCharCode(((c&31)<<6)|(c2&63));i+=2}else{c2=utftext.charCodeAt(i+1);c3=utftext.charCodeAt(i+2);string+=String.fromCharCode(((c&15)<<12)|((c2&63)<<6)|(c3&63));i+=3}}}return string}};Power.provide({base64encode:function(str){if(str==undefined||str.length==0){return""}return Base64.encode(str)},base64decode:function(str){if(str==undefined||str.length==0){return""}return Base64.decode(str)}})})();(function(){var form={};form.checkbox=function(element){var elId=element.id;var id=elId||(element.name?"modal_"+element.name:"modal_"+Power.Number.guid());if(!elId){element.id=id}var inputWrap=$(element).wrap('<div class="uiform-checkbox" />').parent();inputWrap.append("<label for="+id+' class="uiform-label"></label>');$(element).on("change",function(){inputWrap[this.checked?"addClass":"removeClass"]("checked")})};form.checkbox.check=function(element,flag){element.checked=flag;$(element).parent()[flag?"addClass":"removeClass"]("checked")};form.checkbox.disable=function(element,flag){element.disabled=flag;$(element).parent()[flag?"addClass":"removeClass"]("disabled")};form.radio=function(element){var elId=element.id;var id=elId||"modal_"+Power.Number.guid();if(!elId){element.id=id}var inputWrap=$(element).wrap('<span class="modal-radio" />').parent();inputWrap.append("<label for="+id+' class="modal-label"></label>');$(element).on("change",function(){inputWrap[this.checked?"addClass":"removeClass"]("checked")})};Power.extend(form.radio,form.checkbox);["modalCheckbox","modalRadio"].forEach(function(method){var md=method.replace(/^modal/,"").toLowerCase();
$.fn[method]=function(){return this.each(function(){form[md](this)})}});Power.support.propertychange=!!("onpropertychange" in document);var hasPlaceholder;Power.support.placeholder=function(){if(hasPlaceholder==undefined){return hasPlaceholder="placeholder" in document.createElement("input")}return hasPlaceholder};form.placeholder=function(elem){var isEmpty=true;var id=elem.id||"placeholder_"+Power.Number.guid(8).toUpperCase();if($.trim(elem.value)!=""){isEmpty=false}var holder=$(elem).wrap('<div class="form-placeholder" />').parent();var label=$("<label />",{"for":id,"class":"control-placeholder","html":elem.getAttribute("placeholder")||"","style":"padding-left:"+$.css(elem,"padding-left")+"; "+(isEmpty?"":"display: none")}).appendTo(holder)[0];if(!elem.id){elem.id=id}var lang=elem.getAttribute("lanid");if(lang){label.setAttribute("lanid",lang)}$.data(elem,"placeholder.label",label);if(Power.support.propertychange){elem.onpropertychange=function(){var label=$.data(this,"placeholder.label");if(label){if(this.value==""){label.style.display="block"}else{label.style.display="none"}}}}else{if(!form.placeholder.hooked){form.placeholder.hooked=true;$(document).on("input","input[placeholder]",function(){var label=$.data(this,"placeholder.label");if(label){if(this.value==""){label.style.display="block"}else{label.style.display="none"}}})}}};form.placeholder.hooked=false;form.placeholder.empty=function(element){if($.trim(element.value)!=""){var label=$.data(element,"placeholder.label");if(label){label.style.display="none"}}};$.fn.placeholder=function(){if(Power.support.placeholder()){return this}return this.each(function(){form.placeholder(this)})};Power.form=Power.form||{};Power.extend(Power.form,form)})();(function(){var navSwiper=function(){this.init.apply(this,arguments)};navSwiper.prototype={init:function(opts){var that=this;this.options=$.extend({},navSwiper.defaults,opts||{});this.element=$(this.options.scroller);if(!this.element.length){return}Power.include.js("/Scripts/plugins/touchWidget/iScroll.min.js",function(){that.renderSwipe(that.options);that.initEvents()})},renderUI:function(){var navBd=this.swiper=this.element.children().eq(0);var child=navBd.children();var width=0;child.each(function(){width+=(this.offsetWidth+(parseInt($(this).css("margin-left"))||0)+(parseInt($(this).css("margin-right"))))});navBd.width(width)},renderSwipe:function(opt){this.renderUI();this.menu=new iScroll(this.element[0],opt)},initEvents:function(){var that=this;$(window).on("resize",this.resizeHandler=function(){if(that.timer){clearTimeout(that.timer)}that.timer=setTimeout(function(){that.renderUI()},50)})}};navSwiper.defaults={hScrollbar:false};$.fn.navSwiper=function(options){if(!ua.isMobile||!this.length){return this}options=options||{};return this.each(function(){var data=$.data(this,"Power.navSwiper");if(!data){options.scroller=this;return $.data(this,"navSwiper",new navSwiper(options))}})}})();(function(root,undefined){var doc=root.document;var Dialog=function(options){return new Dialog.fn.init(options)};Dialog.prototype={init:function(options){this.options=Power.extend({},Dialog.defaults,options);this.show()},renderTemplate:function(){var sf=this,tpl=sf.options.template.slice();if(!sf.options.button){tpl.splice(10,2)}if(sf.options.extraClass.indexOf("modal-pop")===-1){sf.options.detail=false}if(!sf.options.detail){tpl.splice(7,1)}else{sf.options.closeable=true}if(!sf.options.closeable){tpl.splice(6,1)}else{sf.options.dismiss=true}if(sf.options.title===false){tpl.splice(2,4)}var injectNode=sf.options.insertTo||doc.body;sf.dialog=$(tpl.join("")).appendTo(injectNode);if(sf.options.modal){sf.backdrop=$('<div class="modal-backdrop"></div>').appendTo(injectNode)}var name;sf.dialog.find('*[class^="modal-"]').each(function(){name=this.className;sf[name.split("-").pop()]=$("."+name,sf.dialog)});var dlgCls=" "+sf.options.extraClass;if(sf.options.fullWidth){dlgCls+=" modal-fullwidth"}if(sf.options.detail){dlgCls+=" modal-has-detail"}if(sf.options.closeable){dlgCls+=" modal-has-close"}if(sf.options.fit){dlgCls+=" modal-fit"}if(sf.options.responsive){dlgCls+=" responsive-dialog"}sf.dialog[0].className+=dlgCls;if(sf.options.insertTo||sf.options.follow){sf.dialog.add(sf.backdrop).addClass("modal-custom-position")}if(typeof sf.options.button=="object"){sf.setButton(sf.options.button)}if(sf.options.timeout>0){sf.timer=setTimeout(function(){sf.close()},sf.options.timeout)}return sf},setTitle:function(title){this.title&&(this.title[0].innerHTML=title);return this},setContent:function(content){this.content.html(content);return this},setButton:function(btns){var sf=this,btnOption,param;for(var i in btns){param={"class":"btn btn-default",href:"javascript:;"};btnOption={};if(typeof btns[i]=="function"){param.html=i;btnOption.handler=btns[i]}else{param=Power.extend(param,btns[i]);if(param.icon){param.html='<i class="fa fa-'+param.icon+'"></i>'+i;delete param.icon}else{param.html=i}if(param.theme){param["class"]=param["class"].replace("default",param.theme);
delete param.theme}if(param.closeable==false){btnOption.closeable=false;delete param.closeable}btnOption.handler=param.handler||$.noop;delete param.handler}$("<a />",param).data("Power.dialog.button",btnOption).appendTo(sf.footer)}return this},initEvents:function(){var sf=this;if(sf.footer){sf.footer.on("click",".btn",function(event){event.preventDefault();var ret=$.data(this,"Power.dialog.button");if(ret.handler){if(sf.timer){clearTimeout(sf.timer)}ret.handler.apply(sf,arguments)}if(ret.closeable!==false){sf.close()}})}if(sf.options.dismiss){sf.dialog.on("click","[data-dismiss]",function(event){event.preventDefault();if(sf.timer){clearTimeout(sf.timer)}sf.close()})}if(sf.options.enableEsc){$(doc).on("keyup",(sf.keyupHandler=function(event){if(event.which==27){sf.close()}}))}if(sf.options.detail){sf.dialog.on("click",".showDetail",function(e){if(sf.timer){clearTimeout(sf.timer)}var $this=$(this),dialog=$(sf.dialog),modalDetail=dialog.find(".modal-detail");if(modalDetail.length===0){modalDetail=$("<span />",{"class":"modal-detail","css":{"display":"none"}}).text(sf.options.detail).appendTo(dialog.find(".modal-body"))}if($(this).children("i").hasClass("fa-chevron-down")){modalDetail.slideDown();$(this).attr("title","收起详情").html('<i class="fa fa-chevron-up">')}else{modalDetail.slideUp();$(this).attr("title","显示详情").html('<i class="fa fa-chevron-down">')}})}},setPosition:function(coord){var sf=this;if(sf.options.follow){var offset=Power.getOffset($(sf.options.follow)[0]);var adjust=sf.options.adjust;var targetH=offset.bottom-offset.top;coord={left:offset.right+(adjust.x==undefined?10:adjust.x),top:offset.top+(targetH>sf.dialog[0].offsetHeight?targetH/2+(adjust.y||0)-12:0)};this.dialog.css(coord);return this}if(coord){if(typeof coord=="string"){coord=coord.split(/\s+/);var s1=coord[0];var s2=coord[1];if(s1=="center"&&s2=="center"){coord={left:s1,top:s2}}else{coord={};coord[s1]=s1+(/^\d+$/.test(s1)?"px":"");coord[s2]=s2+(/^\d+$/.test(s2)?"px":"")}}var defPos=Dialog.position;for(var i in coord){if(defPos.hasOwnProperty(coord[i])){coord[i]=defPos[coord[i]];if(typeof coord[i]=="function"){var nCoord=coord[i](i,sf.dialog[0]);for(var k in nCoord){coord[k]=nCoord[k]}}}}this.dialog.css(coord)}return this},show:function(){var sf=this;if(sf.options.onBeforeOpen.call(sf)===false){return sf}sf.renderTemplate().setTitle(sf.options.title);sf.body[0].innerHTML=sf.options.content;if(Power.support.transition){sf.dialog.addClass(sf.options.effect).show();sf.backdrop&&sf.backdrop.addClass("fade").show();setTimeout(function(){sf.dialog.add(sf.backdrop).addClass("in")},50)}else{(Dialog.effects[sf.options.effect]||Dialog.effects.slide).call(sf,"show")}sf.options.onShow.call(sf);sf.setPosition(sf.options.position);sf.initEvents();return sf},close:function(){var sf=this;if(sf.options.onBeforeClose.call(sf)===false){return sf}if(Power.support.transition){sf.dialog.removeClass("in");setTimeout(function(){sf.dialog.remove();if(sf.backdrop){sf.backdrop.removeClass("in");setTimeout(function(){sf.backdrop.remove()},sf.options.speed)}try{sf.options.onClose.call(sf)}catch(e){}},sf.options.speed)}else{(Dialog.effects[sf.options.effect]||Dialog.effects.slide).call(sf,"hide",function(){try{sf.options.onClose.call(sf)}catch(e){}})}if(sf.options.enableEsc){$(doc).off("keyup",sf.keyupHandler)}return sf}};Dialog.defaults={title:false,closeable:true,content:"",button:null,insertTo:null,position:{left:"center",top:30},adjust:{x:10,y:0},speed:200,effect:"zoom",extraClass:"",timeout:0,modal:true,dismiss:true,responsive:true,fit:false,fullWidth:false,follow:false,enableEsc:true,onBeforeOpen:$.noop,onBeforeClose:$.noop,onShow:$.noop,onClose:$.noop,template:Dialog.template,detail:false,};Dialog.position={left:10,top:10,right:10,bottom:10,center:function(direction,el){direction=(direction||"left").toLowerCase();var marginStr="margin"+direction.replace(/(\w)/,function($1){return $1.toUpperCase()});var ret={};ret[direction]="50%";ret[marginStr]=-1*(direction=="left"?el.offsetWidth:el.offsetHeight)/2+"px";return ret}};Dialog.defaults.template=['<div class="modal-dialog power-dialog">','<div class="modal-content">','<div class="modal-header">','<h4 class="modal-title">',"</h4>","</div>",'<a href="#" class="close" data-dismiss="modal" aria-hidden="true" title="关闭(esc)">×</a>','<a href="#" class="showDetail" title="显示详情"><i class="fa fa-chevron-down"></i></a>','<div class="modal-body">',"</div>",'<div class="modal-footer">',"</div>","</div>","</div>"];Dialog.effects={};Dialog.effects.fade=function(action,callback){var sf=this;var speed=sf.options.speed;if(action=="show"){sf.dialog.fadeIn(speed);sf.backdrop&&sf.backdrop.fadeTo(speed,0.5)}else{sf.dialog.fadeOut(speed,function(){sf.backdrop&&sf.backdrop.fadeOut(speed);callback&&callback()})}};Dialog.effects.slide=function(action,callback){var sf=this;var speed=sf.options.speed;if(action=="show"){sf.dialog.show();var pos=sf.options.position;var origTop=sf.options.follow?0:parseFloat(typeof pos=="string"?pos.split(/\s+/)[1]:pos.top);
var height=sf.dialog[0].offsetHeight;var step=sf.dialog[0].step=parseInt(height/3);if(isNaN(origTop)){origTop=-1*height/2}sf.dialog.css({opacity:0,marginTop:origTop-step}).animate({marginTop:origTop,opacity:1},speed);sf.backdrop&&sf.backdrop.fadeTo(speed,0.5)}else{var origTop=parseFloat(sf.dialog[0].style.marginTop)||0;sf.dialog.animate({marginTop:origTop-sf.dialog[0].step,opacity:0},speed,function(){sf.dialog.remove();sf.backdrop&&sf.backdrop.fadeOut(speed,function(){sf.backdrop.remove()});callback&&callback()})}};Dialog.effects.pop=function(action,callback){var sf=this;var speed=sf.options.speed;if(action=="show"){var pos=sf.options.position;if(typeof pos=="string"){sf.options.position=pos.replace(/[^\s]+$/,0)}else{sf.options.position.top=0}sf.dialog.addClass("ie-pop").css({display:"block",marginTop:"-9999px"});sf.dialog.css({marginTop:-1*sf.dialog[0].offsetHeight}).animate({marginTop:0},speed);sf.backdrop&&sf.backdrop.fadeTo(speed,0.5)}else{sf.dialog.animate({marginTop:-1*sf.dialog[0].offsetHeight},speed,function(){sf.dialog.remove();sf.backdrop&&sf.backdrop.fadeOut(speed,function(){sf.backdrop.remove()});callback&&callback()})}};Dialog.fn=Dialog.prototype;Dialog.fn.init.prototype=Dialog.prototype;var format=function(text,icon,color){var tipsTpl='<span class="modal-icon">'+'<i class="fa fa-{icon}"{color}></i>'+"</span>"+'<span class="modal-message">{text}</span>';return tipsTpl.replace(/\{icon\}/,icon).replace(/\{text\}/,text).replace(/\{color\}/,color?"style='color:"+color+"'":"")};Power.ui=Power.ui||{};Power.extend(Power.ui,{dialog:Dialog,confirm:function(msg,opts,handler){if(typeof opts=="function"){handler=opts;opts=undefined}opts=opts||{};return Dialog(Power.extend({title:"确认信息",content:format(msg,opts.icon||"question-circle",opts.iconColor),extraClass:"modal-alert",effect:"slide",responsive:false,position:{left:"center",top:"center"},button:{"确定":{theme:"primary",handler:function(){try{handler.call(this,true)}catch(e){}}},"取消":function(){try{handler.call(this,false)}catch(e){}}}},opts))},alert:function(msg,opts,handler){if(typeof opts=="function"){handler=opts;opts=undefined}opts=opts||{};if(typeof handler=="object"){opts=handler;handler=undefined}return Dialog(Power.extend({title:"提示信息",extraClass:"modal-alert",effect:"slide",responsive:false,content:format(msg,opts.icon||"info-circle",opts.iconColor),position:{left:"center",top:"center"},button:{"确定":{theme:"primary",handler:function(){(handler||$.noop).call(this)}}}},opts))},prompt:function(msg,opts,handler){if(typeof opts=="function"){handler=opts;opts=undefined}opts=opts||{};return Dialog(Power.extend({title:"填写信息",extraClass:"modal-alert modal-prompt",responsive:false,effect:"slide",content:format("<h5>"+msg+'</h5><input type="text" class="form-control" />',opts.icon||"edit",opts.iconColor),position:{left:"center",top:"center"},onShow:function(){var sf=this;sf.prompt=sf.body.find("input")[0];setTimeout(function(){sf.prompt.focus()},200)},button:{"提交":{theme:"primary",closeable:false,handler:function(){(handler||$.noop).call(this,this.prompt.value)}},"取消":$.noop}},opts))},popup:function(msg,opts,handler){opts=opts||{};opts.extraClass="modal-pop "+opts.extraClass||"";return Dialog(Power.extend({timeout:3000,responsive:false,effect:"slide",content:format(msg,opts.icon||"",opts.iconColor),position:{left:"center",top:8},dismiss:false,closeable:false,modal:false,onClose:handler||$.noop},opts))}});var methodMap={info:{extraClass:"modal-info",icon:"info-circle"},success:{extraClass:"modal-success",icon:"check"},error:{extraClass:"modal-error",icon:"bug"},warning:{extraClass:"modal-warning",icon:"exclamation-triangle"},loading:{extraClass:"modal-loading",icon:"loading"}};for(var i in methodMap){(function(i){Power.ui[i]=function(msg,opts,handler){var opt=Power.extend({extraClass:methodMap[i].extraClass,icon:methodMap[i].icon},opts);if(i=="loading"){opt.timeout=0;opt.enableEsc=false;opt.modal=true;return Power.ui.loading.j=Power.ui.popup(msg,opt,handler)}return Power.ui.popup(msg,opt,handler)}})(i)}Power.form=Power.form||{};["info","success","error","warning","loading"].forEach(function(method){Power.form[method]=function(msg,opts){opts=opts||{};var opt=Power.extend({extraClass:"modal-"+method+" modal-mini",icon:methodMap[method].icon,enableEsc:false},opts);if(method=="loading"){opt.timeout=0;return Power.form.loading.j=Power.ui.popup(msg,opt)}return Power.ui.popup(msg,opt)}});["ui","form"].forEach(function(name){Power[name].loading.close=function(){if(Power[name].loading.j){Power[name].loading.j.close();delete Power[name].loading.j}}})})(this);(function(undefined){var menuTpl='<div class="power-menu">'+'<div class="power-menu-inner">'+"</div>"+"</div>";var itemTpl='<li class="power-menu-item">'+'<span class="menu-item-icon">'+'<i class="fa fa-#{iconCls}"></i>'+"</span>"+'<div class="menu-item-text">#{text}</div>'+'<span class="menu-item-arrow">'+'<i class="fa fa-caret-right"></i>'+"</span>"+"</li>";var Menu=function(){return this.init.apply(this,arguments)
};Menu.prototype={plugin:"Power.menu",init:function(element,options){var opts={};if($.isPlainObject(element)){options=element}else{opts=Power.menu.parseOptions((this.body=$(element))[0]);try{this.body[0].removeAttribute("data-options");this.body[0].innerHTML=""}catch(e){}}this.index=0;this.options=Power.extend({},Power.menu.defaults,options,opts);this.items=filterString(this.options.items);return this},create:function(){var sf=this;if(this.isShown){return this}if(!this.element){this.element=$(menuTpl).appendTo(this.options.renderTo||document.body);this.inner=this.element.find(".power-menu-inner");if(!this.body){this.body=$('<ul class="power-menu-body"></ul>').appendTo(this.inner)}else{this.body.removeClass("powerui-menu").addClass("power-menu-body").appendTo(this.inner)}Menu.nodeList.push(this.element[0]);var clsName=[""];if(!this.options.plain){clsName.push("power-menu-complex");var n;this.inner[0].appendChild(n=document.createElement("div"));n.className="power-menu-line"}if(this.hasIcon){clsName.push("power-menu-strip")}if(this.options.extraClass){clsName.push(this.options.extraClass)}this.element[0].className+=clsName.join(" ");if(this.options.style){this.element[0].style.cssText=this.options.style}}if(!$.isArray(this.options.items)){return this}this.options.items.forEach(function(item,index){sf.addItem(item)});this.refresh();this.initEvents();this.isShown=true;return this},refresh:function(){this.options.onCreate.call(this);var el=this.element[0];this.offset={width:el.offsetWidth,height:el.offsetHeight,padTop:parseFloat($.css(el,"padding-top"))};return this},rebuild:function(items){this.origData=[].slice.call(this.options.items);this.isShown=false;this.body.empty();this.index=0;this.options.items=items;this.items=filterString(items);return this.create(items)},show:function(param,calculate){param=param||{};this.create();this.element.css(calculate?this.calculateFlip(param):this.calculateCoord(param));if(this.changeHooked){this.refresh();this.changeHooked=false}this.options.onShow.call(this,param);return this},hide:function(){this.element.css("display","none");this.options.onHide.call(this);return this},calculateCoord:function(coord){var viewPort=getViewPort(),ret={display:"block"};if(viewPort.left+viewPort.width-coord.left<this.offset.width){ret.left=viewPort.width-this.offset.width}else{ret.left=coord.left}if(viewPort.top+viewPort.height-coord.top<this.offset.height){ret.top=coord.top-this.offset.height;ret.top=ret.top<viewPort.top?viewPort.top:ret.top}else{ret.top=coord.top}return ret},calculateFlip:function(offset){var viewPort=getViewPort(),pad=-1*(offset.padTop+1)+"px",ret={display:"block"};if(viewPort.left+viewPort.width-offset.left<offset.width){ret.left="auto";ret.right="100%"}else{ret.left="100%";ret.right="auto"}if(viewPort.top+viewPort.height-offset.top<this.offset.height){ret.bottom=pad;ret.top="auto"}else{ret.top=pad;ret.bottom="auto"}return ret},getData:function(){var checkItem=function(items){var i=items.length;var item;while(i--){item=items[i];if(item.removed){items.splice(i,1)}if(item.children){checkItem(item.children)}}};checkItem(this.items);return this.items},update:function(items){if(!(items instanceof Array)){return this}this.isShown=false;this.options.items=items;this.items=filterVisible(items);return this},getOriginalData:function(){return this.origData||null},getInstance:function(target){if(typeof target=="string"){target=this.getItem(target).target}if(target){var instance=$.data(target,"Power.menu");if(instance){return instance}}return null},parseItem:function(itemObject){if(typeof itemObject=="string"){return'<li class="power-menu-divider"></li>'}var tpl=this.options.itemTpl;if(itemObject.iconCls){this.hasIcon=true}else{tpl=tpl.replace(/<span\s+class="menu\-item\-icon"[^>]*>.+?<\/span>/,"")}if(!itemObject.children){tpl=tpl.replace(/<span\s+class="menu\-item\-arrow"[^>]*>.+?<\/span>/,"")}return Power.String.format(tpl,itemObject)},getPanel:function(){return this.body[0]},getItem:function(itemName){var sf=this,itemData={},index;if(typeof itemName=="string"){var itemsList=[];var tmpItems;var disposeItems=function(items){for(var i=0,Item;i<items.length;i++){Item=items[i];if(Item==undefined){return false}if(Item.name&&Item.name==itemName){itemData=Item;itemData.index=i;return false}if(Item.children){itemsList.push(Item.children)}}};var fetchItem=function(items){items.forEach(function(Item,i){if(disposeItems(Item)==false){return false}});if(itemsList.length>0){tmpItems=itemsList;itemsList=[];arguments.callee(tmpItems)}};fetchItem([sf.items])}else{if(typeof itemName=="object"&&itemName.nodeType!=undefined){itemData=$.data(itemName,"Power.menu.item")||{}}}return itemData},findItem:function(names){var retItems=[];var sf=this;if(typeof names=="string"){names.split(",").forEach(function(name){retItems.push(sf.getItem($.trim(name)))})}return retItems},renderItem:function(itemObject,param){if(itemObject.removed){return this}var menuItem=$(this.parseItem(itemObject))[param.action](param.target)[0];
if(menuItem.className.indexOf("power-menu-divider")>-1){return this}menuItem.setAttribute("name",itemObject.name);if(itemObject.title){menuItem.title=itemObject.title}if(itemObject.children){menuItem.className+=" menu-item-sublist"}if(itemObject.hidden){menuItem.style.display="none"}if(itemObject.className){menuItem.className+=(" "+itemObject.className)}if(itemObject.style){menuItem.style.cssText=itemObject.style}$.data(menuItem,"Power.menu.item",itemObject);itemObject.target=menuItem;itemObject.index=this.index;this.items[this.index]=itemObject;this.index++;if(itemObject.disabled){this.disableItem(menuItem)}return this},addItem:function(itemObject){var param={action:"appendTo",target:this.body};return this.renderItem(itemObject,param)},appendItem:function(itemObject){if(this.isShown){this.addItem(itemObject)}else{this.items.push(itemObject)}this.fixChange();return this},prependItem:function(itemObject){if(this.isShown){var param={action:"prependTo",target:this.body};this.renderItem(itemObject,param);this.items.unshift(this.items.pop())}else{this.items.unshift(itemObject)}parseItemsOrder(this.items);this.fixChange();return this},insertItem:function(param){var action=(param.action||"after").toLowerCase();var actions={before:"Before",after:"After"};var ret=this.getItem(param.target);if(ret.target){param.target=ret.target;param.action="insert"+actions[action];this.renderItem(param.item,param);this.items.pop()}var map=parseItemsMap(this.items);if(map[ret.name]){map[ret.name].splice(action=="before"?ret.index:ret.index+1,0,param.item);parseItemsOrder(map[ret.name])}this.fixChange();return this},removeItem:function(itemName){var ret=this.getItem(itemName);if(ret.target){$(ret.target).remove()}ret.removed=true;this.fixChange();return this},removeItems:function(names){var sf=this;if(names&&typeof names=="string"){names.split(",").forEach(function(name){sf.removeItem($.trim(name))})}return this},updateItem:function(param){var ret=this.getItem(param.target);var Item=param.item;Power.extend(ret,Item);if(!ret.target){return this}if(Item.text){this.setText({target:ret.target,text:Item.text})}if(Item.iconCls){this.setIcon({target:ret.target,iconCls:Item.iconCls})}if(Item.title){ret.target.title=Item.title}if(Item.hidden){ret.target.style.display="none"}if(Item.className){ret.target.className+=(" "+Item.className)}if(Item.style){ret.target.style.cssText=Item.style}if(Item.disabled){this.disableItem(ret.target)}return this},disableItem:function(itemName){var ret=this.getItem(itemName);if(ret.target){var data=$.data(ret.target,"Power.menu.item");if(data.handler){$(ret.target).addClass("menu-item-disabled").data("Power.menu.item.bak",data.handler);delete data.handler}}ret.disabled=true;return this},enableItem:function(itemName){var ret=this.getItem(itemName);if(ret.target){$(ret.target).removeClass("menu-item-disabled");var data=$.data(ret.target,"Power.menu.item");data.handler=$.data(ret.target,"Power.menu.item.bak");$.removeData(ret.target,"Power.menu.item.bak")}try{delete ret.disabled}catch(e){}return this},hideItem:function(itemName){var ret=this.getItem(itemName);if(ret.target){$(ret.target).css("display","none")}ret.hidden=true;this.fixChange();return this},showItem:function(itemName){var ret=this.getItem(itemName);if(ret.target){$(ret.target).css("display","")}try{delete ret.hidden}catch(e){}this.fixChange();return this},fixChange:function(){this.changeHooked=true},setHandler:function(param){if(typeof param!="object"){return this}var ret=this.getItem(param.target);ret.handler=param.handler;return this},setTitle:function(param){if(typeof param!="object"){return this}var ret=this.getItem(param.target);if(ret.target){ret.target.title=param.title}ret.title=param.title;return this},setText:function(param){if(typeof param!="object"){return this}var ret=this.getItem(param.target);if(ret.target){$(ret.target).find(".menu-item-text").text(param.text)}ret.text=param.text;return this},setIcon:function(param){if(typeof param!="object"){return this}var ret=this.getItem(param.target);if(ret.target){var iconEl=$(ret.target).find(".menu-item-icon > i")[0];if(!iconEl){iconEl=$('<span class="menu-item-icon"><i class="fa fa-none"></i></span>').prependTo(ret.target)[0].firstChild}iconEl.className=iconEl.className.replace(iconEl.className.match(/fa\s+fa\-([^\s]*)/)[1],param.iconCls)}ret.iconCls=param.iconCls;return this},initEvents:function(){var sf=this;if(sf.evenHooked){return this}if(this.items.length>0){this.element.on({click:function(event){event.stopPropagation()},contextmenu:function(event){event.preventDefault();event.stopPropagation()}});this.body.on("click",">.power-menu-item",function(event){event.stopPropagation();if($(this).is(".menu-item-disabled, .menu-item-sublist")){return}var ret=$.data(this,"Power.menu.item")||{};if(ret.href){if(ret.blank){window.open(ret.href)}else{location.href=ret.href}}if(ret.handler){ret.handler.call(sf,this,event)}Menu.hide()});this.body.on("mouseenter",">.power-menu-item",function(event){var ret=$.data(this,"Power.menu.item")||{};
if(ret.children){var menu=$.data(this,"Power.menu");if(!menu){menu=$.data(this,"Power.menu",new Menu(Power.extend({},sf.options,{items:ret.children,renderTo:this})))}menu.create();var parent=this.parentNode.parentNode.parentNode;menu.offset.left=Power.getOffset(parent).left+parent.offsetWidth;menu.offset.top=Power.getOffset(this).top;menu.show(menu.offset,true)}});this.body.on("mouseleave",">.power-menu-item",function(event){var menu=$.data(this,"Power.menu");if(menu){menu.hide()}})}if(!Menu.eventHooked){$(document).on("click.Power.menu",function(){Menu.hide()});Menu.eventHooked=true}sf.evenHooked=true},destroy:function(){this.element.remove();Menu.nodeList.forEach(function(element,index){if(element==this.element){Menu.nodeList.splice(index,1);return false}});if(Menu.nodeList.length==0){$(document).off("click.Power.menu")}return this}};Menu.nodeList=[];Menu.hide=function(){$(Menu.nodeList).hide()};Power.provide({menu:function(element,options){return new Menu(element,options)}});Power.menu.defaults={itemTpl:itemTpl,items:[],renderTo:null,plain:false,extraClass:null,style:null,onShow:$.noop,onHide:$.noop,onCreate:$.noop};var getViewPort=function(){var doc=document,docE=doc.documentElement,docB=doc.body,clientW=window.innerWidth||docE.clientWidth||docB.clientHeight,clientH=window.innerHeight||docE.clientHeight||docB.clientHeight,scrollTop=docE.scrollTop||docB.scrollTop,scrollLeft=docE.scrollLeft||docB.scrollLeft;return{width:clientW,height:clientH,left:scrollLeft,top:scrollTop}};var filterString=function(items){var newItems=[];items.forEach(function(item){if(typeof item!=="string"){newItems[newItems.length]=item}});return newItems};var parseItemsOrder=function(items){items.forEach(function(item,i){item.index=i})};var parseItemsMap=function(items){var nameMap={};var genMap=function(itemList){itemList.forEach(function(Item,i){if(Item==undefined){return false}nameMap[Item.name]=itemList;if(Item.children){genMap(Item.children)}})};genMap(items);return nameMap};Power.menu.parseOptions=function(element){if(!element||element.nodeType===undefined){return{}}var childEls=$.grep(element.childNodes,function(node,index){return node.nodeType==1});var options=parseOption(element,"data-options")||{},items=[],elem,item,sublist;for(var i=0;i<childEls.length;i++){elem=childEls[i];if((elem.textContent||elem.innerText).indexOf("---")>-1){items.push("-----");continue}item=parseOption(elem,"data-options");if(item){item.text=$.trim(elem.innerHTML.replace(/<ul[^>]*>(.|[\n\t\r])+<\/ul>/igm,""));if(elem.className){item.className=elem.className}if(elem.getAttribute("style")){item.style=elem.getAttribute("style")}sublist=$(elem).children("ul");if(sublist.length){item.children=arguments.callee(sublist[0]).items}items.push(item)}}if(items.length>0){options.items=items}return options};$.fn.implement("menu",Power.menu);Power.provide({quickMenu:function(options){options=options||{};var items=Power.quickMenu.items;var cb=options.onCreate;options.onCreate=function(){var unit;var len=filterVisible(items).length;if(len<6){unit=len}else{if(len<8||len==9){unit=3}else{if(len<10||len==12||len==16){unit=4}else{unit=5}}}this.element[0].style.width=(48*unit+1)+"px";cb&&cb.call(this)};var extraClass="power-quickmenu";if(options.showText){extraClass+=" power-quickmenu-showText"}return new Menu(Power.extend({extraClass:extraClass,items:items,plain:true},options))}});var handle=function(key){return function(){(Power.quickMenu.methods[key]||$.noop).apply(Power.quickMenu,arguments)}};var filterVisible=function(array){var newArray=[];array.forEach(function(ary){if(!ary.hidden){newArray[newArray.length]=ary}});return newArray};Power.quickMenu.addItem=function(itemObject,index){if(typeof index!="number"){index=this.items.length}this.items.splice(index,0,itemObject)};Power.quickMenu.removeItem=function(name){if(typeof name!="string"){return}var index;this.items.forEach(function(item,i){if(item.name==name){index=i;return false}});this.items.splice(index,1)};Power.quickMenu.removeItems=function(names){var sf=this;if(names&&typeof names=="string"){names.split(",").forEach(function(name){sf.removeItem($.trim(name))})}};Power.quickMenu.editItem=function(name,itemObject){if(typeof name!="string"){return}var newItem;this.items.forEach(function(item){if(item.name==name){newItem=Power.extend(item,itemObject);return false}});return newItem};Power.quickMenu.setOrder=function(order){order=!$.isArray(order)?order.split(","):order;var itemsMap={},newItems=[];this.items.forEach(function(item){itemsMap[item.name]=item});order.forEach(function(name){if(itemsMap.hasOwnProperty($.trim(name))){newItems[newItems.length]=itemsMap[$.trim(name)]}});this.items=newItems;return newItems};Power.quickMenu.addMethod=function(name,method){this.methods[name]=method};Power.quickMenu.methods={};Power.quickMenu.items=[]})();(function(undefined){var rUnit=/^[-\d.]+/,isTransforms=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i,rejectTransforms=/^(opacity|(rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i,transPrefix=Power.transition.name==""?"":"-"+Power.transition.name+"-",lowerKey=function(key){return key.replace(/[A-Z]/g,function(m){return"-"+m.toLowerCase()
})},upperKey=function(key){return key.replace(/\-(\w)/g,function(m,n){return n.toUpperCase()})},getPercent=function(start,end,pos){return(start+(end-start)*pos).toFixed(6)},convertTranslateValue=function(param){var translateMap={translateX:"marginLeft",translateY:"marginTop"};for(var i in param){if(translateMap.hasOwnProperty(i)){param[translateMap[i]]=param[i]}if(isTransforms.test(i)){delete param[i]}}return param},renderAttrs=function(elem,index){var a={"overflow":"hidden"},b={"overflow":"hidden"},c={"overflow":""};transition.fxAttrs[index].forEach(function(h,i){a[h]=h=="opacity"?"0":"0px";b[h]=h=="opacity"?"1":transition.getStyle(elem,h);c[h]=""});return{cssOrig:a,cssTrans:b,cssEnd:c}},transition=function(elem){this.elem=elem;this.$elem=$(elem);this.trans=transPrefix+"transition"};transition.fxAttrs=[["width","height","opacity","margin-top","margin-right","margin-bottom","margin-left","padding-top","padding-right","padding-bottom","padding-left","border-top-width","border-right-width","border-bottom-width","border-left-width"],["height","margin-top","margin-bottom","padding-top","padding-bottom","border-top-width","border-bottom-width"],["width","margin-left","margin-right","padding-left","padding-right","border-left-width","border-right-width"]];transition.setStyle=function(elem,props){for(var i in props){if(props.hasOwnProperty(i)){elem.style[upperKey(i)]=props[i].constructor==Array?props[i].join(" "):props[i]}}};transition.getStyle=window.getComputedStyle?function(elem,prop){return elem.ownerDocument.defaultView.getComputedStyle(elem,null)[upperKey(prop)]}:function(elem,prop){return $.css(elem,prop)};transition.prototype={animate:function(){var arg=arguments;this.queue(function(){this.run.apply(this,arg)});return this},run:function(props,speed,ease,fn){var sf=this,prop,origCss,def={fast:200,normal:400,slow:600};var fired=false,rejectProp=[],transitHash=[],origProps={};sf.elem.isTransiting=true;sf.speed=speed;if(typeof speed!="number"){speed=sf.speed=def[speed]||def["normal"]}if(typeof ease==="function"){fn=ease;ease=undefined}for(var key in props){if(key=="overflow"){continue}prop=props[key];if(!rejectTransforms.test(key)&&String(prop).replace(rUnit,"")==""){prop=props[key]=prop+"px"}if(isTransforms.test(key)){delete props[key];if(/^(?:rotate|skew)$/.test(key)){prop=typeof prop=="number"?prop+"deg":prop}ret=key+"("+prop+")";key=(transPrefix+"transform");if(!props[key]){props[key]=[]}props[key].push(ret)}if(typeof props[key]!="object"){origCss=transition.getStyle(sf.elem,key);origProps[key]=isNaN(parseFloat(origCss))?"0px":origCss}transitHash.push([lowerKey(key),speed+"ms",ease||"linear"].join(" "))}props[sf.trans]=transitHash.join(",");props[transPrefix+"backface-visibility"]="hidden";sf.origProps=origProps;sf.props=props;sf.startTime=+new Date;transition.setStyle(sf.elem,props);sf.transEndHandler=function(){fired=true;sf.restore();sf.dequeue();$.isFunction(fn)&&fn.call(sf.elem)};sf.elem.addEventListener(Power.transition.end,sf.transEndHandler,false);sf.runTimer=setTimeout(function(){if(fired){return}sf.transEndHandler.call(sf)},speed+30);return sf},restore:function(){var sf=this;sf.elem.style[upperKey(sf.trans)]="";sf.elem.style[upperKey(transPrefix+"backface-visibility")]="";sf.elem.removeEventListener(Power.transition.end,sf.transEndHandler,false);try{delete sf.elem["isTransiting"]}catch(e){if(sf.elem.removeAttribute){sf.elem.removeAttribute("isTransiting")}}return sf},isTransited:function(){return !Boolean(this.elem["isTransiting"])},queue:function(data){var sf=this;var fx=$.data(sf.elem,"transitQueue")||$.data(sf.elem,"transitQueue",[]);if(data){fx.push(data)}if(fx[0]!=="running"){sf.dequeue()}return this},dequeue:function(){var sf=this;var fx=$.data(sf.elem,"transitQueue")||[];fn=fx.shift();if(fn==="running"){fn=fx.shift()}if(fn){fx.unshift("running");if(typeof fn=="number"){setTimeout(function(){sf.dequeue()},fn)}else{if(typeof fn=="function"){fn.call(sf)}}}if(!fx.length){$.removeData(sf.elem,"transitQueue")}return this},delay:function(duration){if(typeof duration=="number"){this.queue(duration)}return this},stop:function(stopQueue){var sf=this;if(!sf.elem.isTransiting){return sf}if(sf.runTimer){clearTimeout(sf.runTimer)}var percent=(+new Date-sf.startTime)/sf.speed,options={};var transValue,transRate,prop,origValue="0";for(var i in sf.props){if(typeof sf.props[i]=="string"){prop=[sf.props[i]]}else{prop=sf.props[i]}for(var n=0;n<prop.length;n++){transValue=prop[n].replace(/\d+/,"@vlaue");if(/^(scale)/.test(prop[n])){origValue="1"}transRate=getPercent(Number((sf.origProps[i]||"").match(/\d+/)||origValue),Number(prop[n].match(/\d+/)),percent);if(!options[i]){options[i]=[]}options[i].push(transValue.replace("@vlaue",transRate))}}transition.setStyle(sf.elem,options);sf.restore();!stopQueue&&sf.dequeue()},show:function(speed,ease,fn){if(arguments.length==0){this.$elem.show();return this}return this.queue(16).queue(function(){var sf=this;sf.$elem.show();if(typeof speed=="function"){fn=speed;speed=ease=undefined
}if(typeof ease==="function"){fn=ease;ease=undefined}var ret=renderAttrs(sf.elem,0);var callback=function(){transition.setStyle(sf.elem,ret.cssEnd);$.isFunction(fn)&&fn.call(sf.elem)};transition.setStyle(sf.elem,ret.cssOrig);sf.run(ret.cssTrans,speed,ease,callback)})},hide:function(speed,ease,fn){if(arguments.length==0){this.$elem.hide();return this}return this.queue(16).queue(function(){var sf=this;if(typeof speed=="function"){fn=speed;speed=ease=undefined}if(typeof ease==="function"){fn=ease;ease=undefined}var ret=renderAttrs(sf.elem,0);var callback=function(){transition.setStyle(sf.elem,ret.cssEnd);sf.$elem.hide();$.isFunction(fn)&&fn.call(sf.elem)};sf.run(ret.cssOrig,speed,ease,callback)})},toggle:function(){var sf=this;sf[transition.getStyle(sf.elem,"display")=="none"?"show":"hide"].apply(sf,arguments);return sf},fadeIn:function(speed,ease,fn){var arg=[].slice.call(arguments);return this.queue(16).queue(function(){var sf=this;var opacity=transition.getStyle(sf.elem,"opacity");arg.unshift({"opacity":opacity});transition.setStyle(sf.elem,{"opacity":"0"});sf.$elem.show();if(typeof arg[1]=="function"){arg[3]=arg[1];arg[1]=arg[2]=undefined}sf.run.apply(sf,arg)})},fadeOut:function(speed,ease,fn){return this.queue(16).queue(function(){var sf=this;if(typeof speed=="function"){fn=speed;speed=ease=undefined}if(typeof ease==="function"){fn=ease;ease=undefined}var callback=function(){transition.setStyle(sf.elem,{"opacity":""});sf.$elem.hide();$.isFunction(fn)&&fn.call(sf.elem)};sf.run({"opacity":"0"},speed,ease,callback)})},fadeTo:function(speed,opacity,ease,fn){var arg=[].slice.call(arguments);return this.queue(16).queue(function(){var sf=this;var opacity=arg.splice(1,1);arg.unshift({"opacity":opacity[0]});sf.run.apply(sf,arg)})},fadeToggle:function(){var sf=this;sf[transition.getStyle(sf.elem,"display")=="none"||transition.getStyle(sf.elem,"opacity")==0?"fadeIn":"fadeOut"].apply(sf,arguments);return sf}};["slideDown","swipeRight"].forEach(function(name,index){transition.prototype[name]=function(speed,ease,fn){return this.queue(16).queue(function(){var sf=this;sf.$elem.show();if(typeof speed=="function"){fn=speed;speed=ease=undefined}if(typeof ease==="function"){fn=ease;ease=undefined}var ret=renderAttrs(sf.elem,Number(index)+1);var callback=function(){transition.setStyle(sf.elem,ret.cssEnd);$.isFunction(fn)&&fn.call(sf.elem)};transition.setStyle(sf.elem,ret.cssOrig);sf.run(ret.cssTrans,speed,ease,callback)})}});["slideUp","swipeLeft"].forEach(function(name,index){transition.prototype[name]=function(speed,ease,fn){return this.queue(16).queue(function(){var sf=this;if(typeof speed=="function"){fn=speed;speed=ease=undefined}if(typeof ease==="function"){fn=ease;ease=undefined}var ret=renderAttrs(sf.elem,Number(index)+1);var callback=function(){transition.setStyle(sf.elem,ret.cssEnd);sf.$elem.hide();$.isFunction(fn)&&fn.call(sf.elem)};transition.setStyle(sf.elem,ret.cssTrans);sf.run(ret.cssOrig,speed,ease,callback)})}});["slide","swipe"].forEach(function(name,index){var animDir={slide:["Up","Down"],swipe:["Left","Right"]};transition.prototype[name+"Toggle"]=function(){return this[name+animDir[name][this.$elem.is(":visible")?0:1]].apply(this,arguments)}});["Left","Right"].forEach(function(name,index){$.fn["swipe"+name]=function(speed,ease,fn){if(typeof speed=="function"){fn=speed;speed=ease=undefined}if(typeof ease==="function"){fn=ease;ease=undefined}if($.easing[ease]==undefined){ease="swing"}this.each(function(){var $this=$(this);if(index==1){$this.show()}var ret=renderAttrs(this,2);var callback=function(){$this.css(ret.cssEnd);if(index==0){$this.hide()}$.isFunction(fn)&&fn.call(this)};if(index==1){$this.css(ret.cssOrig)}$this.animate((index==0?ret.cssOrig:ret.cssTrans),speed,ease,callback)});return this}});$.fn.swipeToggle=function(speed,ease,fn){return this.each(function(){$(this)[$.css(this,"display")=="none"?"swipeRight":"swipeLeft"](speed,ease,fn)})};$.transition=function(element){element=typeof element=="string"?document.getElementById(element):element;if(Power.support.transition){var data=$.data(element,"jQuery.transition");if(!data){return $.data(element,"jQuery.transition",new transition(element))}return data}return $(element)};$.transition.addMethod=function(name,method){var methodObject={};var structor=Power.support.transition?transition.prototype:$.fn;if(arguments.length==1&&typeof name=="object"){methodObject=name}else{if(typeof name=="string"){methodObject[name]=method}}for(var i in methodObject){if(methodObject.hasOwnProperty(i)){structor[i]=methodObject[i]}}return methodObject};$.fn.transition=function(){var arg=[].slice.call(arguments);var method=arg.shift();if(typeof method=="object"){arg.unshift(method);method="animate"}if(Power.support.transition){return this.each(function(){var animInst=$.data(this,"jQuery.transition");if(!animInst){animInst=$.data(this,"jQuery.transition",new transition(this))}return(animInst[method]||animInst["animate"]).apply(animInst,arg)})}arg[0]=convertTranslateValue(arg[0]);
if(typeof arg[1]=="string"&&$.easing[arg[1]]==undefined){arg[1]="swing"}if(typeof arg[2]=="string"&&$.easing[arg[2]]==undefined){arg[2]="swing"}return($.fn[method]||$.fn["animate"]).apply(this,arg)}})();Power.history={map:{},maxLength:8,cookieName:"Power.history",itemTpl:"<li>"+'<a data-tab="#{tabFlag}" #{key} data-frame="true" data-history="false" id="link_hist_#{id}" class="menu-item" href="#{url}">'+'<span class="timeline-dot">#{icon}#{vml}</span>'+'<span class="title">#{text}</span>'+"</a>"+'<span class="item-remove" title="删除该条记录"><i class="fa fa-trash-o"></i></span>'+"</li>",contains:function(item){for(var i=0;i<this.list.length;i++){if(this.list[i].id==item.id){return i}}return false},setIcon:function(icon){return Power.detect.isImgPath(icon)?'<img src="'+icon+'" />':'<i class="'+icon+'"></i>'},addItem:function(param){var index,sf=this;if((index=sf.contains(param))!==false){$("#link_hist_"+param.id).parent().remove();sf.list.splice(index,1)}var tpl=sf.itemTpl;param.icon=sf.setIcon(param.iconCls);var key=param.key;if(key){param.key="data-key='"+key+"'"}else{param.key=key=""}param.vml=sf.createVMLHTML();$(substitute(tpl,param)).prependTo(sf.sidebarNode);delete param.icon;delete param.vml;param.key=key;sf.list.unshift(param);if(sf.list.length>sf.maxLength){sf.sidebarNode.children().last().remove();sf.list.pop()}sf.clearNode.parent().show();if(window.$config&&$config.currentHumanId){if(this.map[$config.currentHumanId]==undefined){this.map[$config.currentHumanId]=this.list}}},prependItem:function(id){if(!id){return this}var curItem=$("#link_hist_"+id).parent();var curr=this.list.splice(curItem.index(),1)[0];curItem.prependTo(this.sidebarNode);this.list.unshift(curr);return this},removeItem:function(id){var sf=this;var index;for(var i=0;i<sf.list.length;i++){if((typeof id=="number"&&i==id)||sf.list[i].id==id){index=i;sf.list.splice(i,1);break}}sf.sidebarNode.find("li").eq(index).remove();if(sf.list.length==0){sf.clearNode.parent().hide()}},setCurrent:function(id){this.hookItem=id},getCurrent:function(){return this.hookItem},createVMLHTML:function(){return _createVMLHTML("oval",{width:30,height:30,color:"#428bca"})},clear:function(){this.list=[];try{delete this.map[$config.currentHumanId]}catch(ex){}this.sidebarNode.empty();this.clearNode.parent().hide()},refresh:function(){return this.display()},display:function(el){var sf=this;var histHTML="";sf.list.forEach(function(data){data.icon=sf.setIcon(data.iconCls);data.vml=sf.createVMLHTML();histHTML+=substitute(sf.itemTpl,data);delete data.icon;delete data.vml});if(sf.list.length>0){sf.clearNode.parent().show()}(el?$(el):sf.sidebarNode).html(histHTML)},getData:function(){var historyMap=Power.cookie.get(this.cookieName);if(historyMap!=null){this.map=JSON.parse(historyMap)}if(window.$config&&$config.currentHumanId){this.list=this.map[$config.currentHumanId]||[]}else{this.list=[]}},save:function(data){return Power.cookie.set(this.cookieName,data?data:JSON.stringify(this.map),1000)},initEvents:function(){var sf=this;$(window).on("beforeunload",function(){sf.save()});sf.sidebarNode.on("click",".item-remove",function(){var parent=$(this).closest("li");sf.removeItem(parent.index())});sf.clearNode.on("click",function(){sf.clear()})},init:function(){this.getData();this.clearNode=$("#history-clear");this.sidebarNode=$("#sidebar-history");this.display();this.initEvents()}};Power.App=function(){var sidebarWidth=225;var sidebarCollapsedWidth=35;var responsiveHandlers=[];var layoutColorCodes={"blue":"#4b8df8","red":"#e02222","green":"#35aa47","purple":"#852b99","grey":"#555555","light-grey":"#fafafa","yellow":"#ffb848"};var setClientUA=function(){var $body=$(document.body);if($body.css("direction")==="rtl"){ua.isRTL=true}var addCls=[];if(ua.msie){addCls.push("ie")}if(ua.ie8){addCls.push("ie8")}if(ua.ie9){addCls.push("ie9")}if(ua.isTouch){addCls.push("touch");if(ua.isMobile){addCls.push("mobile")}if(ua.isPad){addCls.push("touchpad")}}else{addCls.push("desktop")}if(addCls.length){var docEl=document.documentElement;var docCls=docEl.className;if(docCls){var i=addCls.length;while(i--){if(docCls.indexOf(addCls[i])>0){addCls.splice(i,1)}}}docEl.className=$.trim(docCls+" "+addCls.join(" "))}};var handlePlaceHolder=function(container){$(container||"input[placeholder]").placeholder()};var handleBadgeVML=function(container,text){if(ua.modern){return}var badges=$(container||document.body).find(".badge");if(!badges.length){return}var colorMap={success:"#3CC051","default":"#999",primary:"#428bca",warning:"#fcb322",danger:"#ed4e2a",info:"#57b5e3"};badges.each(function(){var type=/badge\-(\w+)?$/.exec(this.className)||[];var value=text==undefined?this.innerText:text;var count=String(parseInt(value)).length;this.innerHTML='<span class="badge-number">'+value+"</span>"+_createVMLHTML("roundrect",{width:18+(count-1)*7,height:18,color:colorMap[type[1]]||"#e02222"})})};var runResponsiveHandlers=function(){var handler;for(var i=0;i<responsiveHandlers.length;i++){handler=responsiveHandlers[i];if(typeof handler==="function"){try{handler.call()
}catch(e){}}}};var handleResponsive=function(){runResponsiveHandlers()};var handleResponsiveOnInit=function(){handleSidebarAndContentHeight()};var handleResponsiveOnResize=function(){var resize;var $win=$(window);var docH;if(ua.kickout||ua.ie8){var currheight;$win.resize(function(){docH=document.documentElement.clientHeight;if(currheight==docH){return}if(resize){clearTimeout(resize)}resize=setTimeout(function(){handleResponsive()},50);currheight=docH})}else{$win.resize(function(){if(resize){clearTimeout(resize)}resize=setTimeout(function(){handleResponsive()},50)})}};var handleSidebarAndContentHeight=function(){return 0;var content=$(".page-content");var sidebar=$(".page-sidebar");var body=$(document.body);var height;if(body.hasClass("page-footer-fixed")&&!body.hasClass("page-sidebar-fixed")){var available_height=$(window).height()-$(".footer").outerHeight();if(content.height()<available_height){content.attr("style","min-height:"+available_height+"px !important")}}else{if(body.hasClass("page-sidebar-fixed")){height=_calculateFixedSidebarViewportHeight()}else{height=sidebar.height()+20}if(height>=content.height()){content.attr("style","min-height:"+height+"px !important")}}};var handleSidebarMenu=function(){var sidebar=$("#page-left");var menuContainer=$("#sidebarLeft");var pageContent=$("#page-content");sidebar.on("click","li > a",function(e){e.preventDefault();if(Power.menu.showSub&&!$(this).hasClass("item-super")){return}var the=$(this);var submenu=the.next(".sub-menu");if(!submenu.length||submenu.hasClass("always-open")){return}var parent=the.parent();parent.toggleClass("open");setTimeout(function(){handleScrollers("#sidebarLeft",true)},100)});sidebar.on("click"," li > a.ajaxify",function(e){e.preventDefault();Power.App.scrollTop();var $this=$(this);var url=this.href;menuContainer.children("li.active").removeClass("active");menuContainer.find("span.arrow.open").removeClass("open");$this.parents("li").each(function(){$this.addClass("active");$this.find("span.arrow").addClass("open")});$this.parents("li").addClass("active");$.ajax({type:"GET",cache:false,async:false,url:url,dataType:"html",success:function(res){Power.App.unblockUI(pageContent);pageContent.html(res);Power.App.fixContentHeight();Power.App.initAjax()},error:function(xhr,ajaxOptions,thrownError){pageContent.html("<h4>Could not load the requested content.</h4>");Power.App.unblockUI(pageContent)}})})};var sidebarStatus={left:false,right:false};var handleSidebarToggler=function(){var timeout={};var sidebar=$(".page-sidebar");var $body=$("body");if($("#sidebar-pin").hasClass("sidebar-pined")){sidebarStatus.left=true}if($("#history-pin").hasClass("sidebar-pined")){sidebarStatus.right=true}sidebar.data("sidebar.status",0);if(!Power.ua.isTouch){sidebar.on("mouseenter",function(){var asign="left";if(/(^|\s+)sidebar\-right(\s+|$)/.test(this.className)){asign="right"}if(timeout[asign]){clearTimeout(timeout[asign])}if(sidebarStatus[asign]){return}var $this=$(this);if(!$this.hasClass("sidebar-open")){var animProp={};animProp[asign]="-215px";$this.addClass("sidebar-hint").transition(animProp,400,"ease-out")}});sidebar.on("mouseleave",function(){var asign="left";if(/(^|\s+)sidebar\-right(\s+|$)/.test(this.className)){asign="right"}if(sidebarStatus[asign]){return}var $this=$(this);$this.removeClass("sidebar-hint");if($this.hasClass("sidebar-open")){timeout[asign]=setTimeout(function(){Power.App.sidebar.hide(asign)},800)}else{var animProp={};animProp[asign]="-225px";$(this).transition(animProp,400,"ease-out")}})}try{document.getElementById("page-mask").addEventListener(Power.ua.events.start,function(e){e.stopPropagation();Power.App.sidebar.hide("right")},false)}catch(e){}$body.on("click","[data-sidebar]",function(e){e.preventDefault();e.stopPropagation();var asign=this.getAttribute("data-sidebar")||"left";var parent=$("#page-"+asign);Power.App.sidebar.trigger=this;parent.removeClass("sidebar-hint");if(parent.hasClass("sidebar-open")){Power.App.sidebar.hide(asign)}else{Power.App.sidebar.show(asign)}});$body.on("click","[data-fixed='sidebar']",function(){var asign=this.hasAttribute("data-toggler")?this.getAttribute("data-toggler"):"left";sidebarStatus[asign]=!sidebarStatus[asign];if(sidebarStatus[asign]){$(this).addClass("sidebar-pined")}else{$(this).removeClass("sidebar-pined")}Power.App.sidebar.fixed(sidebarStatus["left"]);this.title=sidebarStatus[asign]?"收缩列表":"固定列表"})};var handleGoTop=function(){$("body").on("click",".go-top",function(e){App.scrollTo();e.preventDefault()})};var handlePortletTools=function(){var $body=$(document.body);$body.on("click",".portlet > .portlet-title > .tools > a.remove",function(e){e.preventDefault();$(this).closest(".portlet").remove()});$body.on("click",".portlet > .portlet-title > .tools > a.reload",function(e){e.preventDefault();var el=$(this).closest(".portlet").children(".portlet-body");App.blockUI(el);window.setTimeout(function(){App.unblockUI(el)},1000)});$body.on("click",".portlet > .portlet-title > .tools > .collapse, .portlet .portlet-title > .tools > .expand",function(e){e.preventDefault();
var $this=$(this);var el=$this.closest(".portlet").children(".portlet-body");if($this.hasClass("collapse")){$this.removeClass("collapse").addClass("expand");el.slideUp(200)}else{$this.removeClass("expand").addClass("collapse");el.slideDown(200)}})};var handleUniform=function(){if(!$().uniform){return}var test=$("input[type=checkbox]:not(.toggle), input[type=radio]:not(.toggle, .star)");if(test.size()>0){test.each(function(){if($(this).closest(".checker").size()==0){$(this).show().uniform()}})}};var handleTabs=function(){if(location.hash){var tabid=location.hash.substr(1);$('a[href="#'+tabid+'"]').click()}};var handleModals=function(){var $html=$("html");var $body=$(document.body);$body.on("hide.bs.modal",function(){if($(".modal:visible").size()>1&&!$html.hasClass("modal-open")){$html.addClass("modal-open")}else{if($(".modal:visible").size()<=1){$html.removeClass("modal-open")}}});$body.on("show.bs.modal",".modal",function(){if($(this).hasClass("modal-scroll")){$body.addClass("modal-open-noscroll")}});$body.on("hide.bs.modal",".modal",function(){$body.removeClass("modal-open-noscroll")})};var handleTooltips=function(){$(".tooltips").tooltip()};var handleDropdowns=function(){if(App.isTouchDevice()){$('[data-hover="dropdown"]').each(function(){$(this).parent().off("hover");$(this).off("hover")})}$("body").on("click",".dropdown-menu.hold-on-click",function(e){e.stopPropagation()})};var lastPopedPopover;var handlePopovers=function(){$(".popovers").popover();$(document).on("click.bs.popover.data-api",function(e){if(lastPopedPopover){lastPopedPopover.popover("hide")}})};var handleScrollers=function(selector,ignoreResize){if(Power.ua.isTouch){return}selector=$(selector||".scroller");function doScroller(){selector.each(function(){var height,$this=$(this);if(this.hasAttribute("data-height")){height=parseFloat($this.attr("data-height"))}else{height=this.offsetHeight;var reduce=this.getAttribute("data-reduce");if(reduce){height=height-parseFloat(reduce)}}var isRTL=false;$this.slimScroll({size:"7px",color:(this.hasAttribute("data-handle-color")?$this.attr("data-handle-color"):"#a1b2bd"),railColor:(this.hasAttribute("data-rail-color")?$this.attr("data-rail-color"):"#333"),position:isRTL?"left":"right",height:height,alwaysVisible:($this.attr("data-always-visible")=="1"?true:false),railVisible:($this.attr("data-rail-visible")=="1"?true:false),disableFadeOut:true})})}function CalculateHeight(){selector.each(function(){var height=this.parentNode.parentNode.offsetHeight-(parseFloat(this.getAttribute("data-reduce"))||0);this.parentNode.style.height=height+"px";this.style.height=height+"px"})}if(!ignoreResize){var _timeout;$(window).on("resize.app.slimScroll",function(){if(_timeout){clearTimeout(_timeout)}_timeout=setTimeout(function(){CalculateHeight();doScroller()},100)})}if(!$.fn.slimScroll){Power.include.js("/Scripts/plugins/jQuery/jquery-slimscroll/jquery.slimscroll.min.js",doScroller)}else{doScroller()}};var handlePlaceholderForIE=function(){if(ua.ie8||ua.ie9){$("input[placeholder]:not(.placeholder-no-fix), textarea[placeholder]:not(.placeholder-no-fix)").each(function(){var input=$(this);var placement=input.attr("placeholder");if(input.val()==""&&placement!=""){input.addClass("placeholder").val(placement)}input.focus(function(){if(input.val()==placement){input.val("")}});input.blur(function(){if(input.val()==""){input.val(placement)}})})}};var toggleFullScreen=function(callback){if(!document.fullscreenElement&&!document.mozFullScreenElement&&!document.webkitFullscreenElement){if(document.documentElement.requestFullscreen){document.documentElement.requestFullscreen()}else{if(document.documentElement.mozRequestFullScreen){document.documentElement.mozRequestFullScreen()}else{if(document.documentElement.webkitRequestFullscreen){document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}}}callback&&callback(true)}else{if(document.cancelFullScreen){document.cancelFullScreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}}}callback&&callback(false)}};var handleFullScreen=function(){$("#trigger_fullscreen").click(function(){var $this=$(this);toggleFullScreen(function(status){$this[0].innerHTML=status==true?'<i class="micon-size-actual"></i>退出全屏':'<i class="micon-size-fullscreen"></i>全屏'})})};return{init:function(){if(typeof $config=="object"&&$config.menuJson){setClientUA();handlePlaceHolder();handleResponsiveOnResize();handleFullScreen();handleSidebarToggler();handleBadgeVML("#header")}else{setClientUA();$(".tabbable-line").navSwiper()}},initAjax:function(){handleDropdowns();handleTooltips();handlePopovers();handleAccordions()},setClientUA:setClientUA,setPlaceHolder:handlePlaceHolder,setLastPopedPopover:function(el){lastPopedPopover=el},sidebar:{cookieName:"Power.sidebar.fixed",isFixed:function(){return Power.cookie.get(this.cookieName)!=null},show:function(side,anim){side=side.toLowerCase();var sidebar=$("#page-"+side),sideMap={left:"right",right:"left"};
var animProp={};animProp[side]=0;Power.App.sidebar.trigger=this;if(anim==undefined||anim==true){sidebar.addClass("sidebar-open").transition(animProp,400,"ease-out")}else{sidebar.addClass("sidebar-open").css(animProp)}sidebar.data("sidebar.status",1);if(side=="right"){$.transition("page-mask").fadeIn()}if(this.trigger){$(this.trigger).addClass("trigger-open")}return this},hide:function(side,anim){side=side.toLowerCase();var sidebar=$("#page-"+side),sideMap={left:"right",right:"left"};var animProp={};animProp[side]="-225px";if(anim==undefined||anim==true){sidebar.transition(animProp,400,"ease-out",function(){$(this).removeClass("sidebar-open");this.style[side]="";if(side=="right"){Power.history.prependItem(Power.history.getCurrent())}})}else{sidebar.removeClass("sidebar-open");if(side=="right"){Power.history.prependItem(Power.history.getCurrent())}}sidebar.data("sidebar.status",0);if(side=="right"){$.transition("page-mask").fadeOut()}else{this.fixed(false)}if(sidebarStatus[side]){sidebarStatus[side]=false;sidebar.find(".sidebar-collapse").removeClass("sidebar-pined").attr("title","固定列表")}if(this.trigger){$(this.trigger).removeClass("trigger-open");delete this.trigger}return this},fixed:function(switchType){switchType=switchType==undefined?true:switchType;sidebarStatus["left"]=switchType;var contain=$("#page-outer");var panel=$("#page-left");if(switchType){panel.css("left","0px").addClass("sidebar-open sidebar-fixed");contain.css("margin-left","225px");$("#sidebar-pin").addClass("sidebar-pined").attr("title","收缩列表");Power.cookie.set(this.cookieName,"1",1000)}else{panel.css("left","").removeClass("sidebar-open sidebar-fixed");contain.css("margin-left","");Power.cookie.set(this.cookieName,"")}return this}},loading:{_create:function(){var tpl='<div id="Power-loader" class="power-loading">'+'<div class="loading-spinner"></div>'+"</div>";return $(tpl).appendTo(document.body)},_init:function(){this.loader=$("#Power-loader");if(!this.loader.length){this.loader=this._create()}if(ua.modern&&!ua.ie9){return}var loaderEl=this.loader[0];var bodyEl=loaderEl.getElementsByTagName("*")[0];this.spinner=document.createElement("div");this.spinner.className="loading-spinner-forie";bodyEl.appendChild(this.spinner);if(ua.ie9){return}var outerVML=Power.createVML("oval",{css:{width:70,height:70},attr:{fillcolor:this.loader.css("background-color")}});var innerVML=Power.createVML("oval",{css:{width:50,height:50},attr:{fillcolor:$(bodyEl).css("background-color")}});this.loader.add(bodyEl).css("background","none");var span=document.createElement("span");loaderEl.insertBefore(outerVML,loaderEl.firstChild);bodyEl.appendChild(innerVML);bodyEl.appendChild(span)},_start:function(){if(!this.spinner){return}var sf=this;var index=0;if(this.timer){return}this.timer=setInterval(function(){if(index>17){index=0}sf.spinner.style.backgroundPositionX=-1*(index++*60)+"px"},60)},_stop:function(){if(!this.spinner){return}if(this.timer){clearInterval(this.timer)}this.spinner.style.backgroundPositionX=""},show:function(){if(!this.hooked){this._init();this.hooked=true}if(this.isShown){return}this._start();this.loader.css("display","block");this.isShown=true},hide:function(){if(this.loader){this.loader.css("display","none");this._stop()}this.isShown=false}},addResponsiveHandler:function(func){responsiveHandlers.push(func)},setEqualHeight:function(els){var tallestEl=0;els=jQuery(els);els.each(function(){var currentHeight=$(this).height();if(currentHeight>tallestEl){tallestColumn=currentHeight}});els.height(tallestEl)},scrollTo:function(el,offeset){var pos=(el&&el.size()>0)?el.offset().top:0;$("html, body").animate({scrollTop:pos+(offeset?offeset:0)},"normal")},scrollTop:function(){this.scrollTo()},toggleFullScreen:toggleFullScreen,blockUI:function(el,centerY){var el=$(el);if(el.height()<=400){centerY=true}el.block({message:'<img src="./assets/img/ajax-loading.gif" align="">',centerY:centerY!=undefined?centerY:true,css:{top:"10%",border:"none",padding:"2px",backgroundColor:"none"},overlayCSS:{backgroundColor:"#000",opacity:0.05,cursor:"wait"}})},unblockUI:function(el,clean){$(el).unblock({onUnblock:function(){$(el).css({"position":"","zoom":""})}})},setupScroller:function(selector,ignoreResize){return handleScrollers(selector,ignoreResize)},updateUniform:function(els){$.uniform.update(els)},setBadgeVML:handleBadgeVML,getActualVal:function(el){var el=$(el);if(el.val()===el.attr("placeholder")){return""}return el.val()},getLayoutColorCode:function(name){if(layoutColorCodes[name]){return layoutColorCodes[name]}else{return""}}}}();$(function(){Power.App.init()})})(jQuery,window,document);